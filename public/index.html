<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>友链检查器 - Friend Link Checker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
        }

        .info-bar {
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .last-update {
            font-weight: bold;
            color: #2c3e50;
        }

        .total-links {
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .refresh-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }

        .refresh-btn:hover {
            background: #27ae60;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .status-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .status-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .status-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
            border: 2px solid #eee;
        }

        .status-info {
            flex: 1;
        }

        .status-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .status-link {
            color: #3498db;
            text-decoration: none;
            font-size: 0.9rem;
            word-break: break-all;
        }

        .status-link:hover {
            text-decoration: underline;
        }

        .status-indicator {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-success {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-error {
            background: #fadbd8;
            color: #e74c3c;
        }

        .status-timeout {
            background: #f8c471;
            color: #d35400;
        }

        .status-details {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }

        .response-time {
            margin-top: 5px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #7f8c8d;
        }

        .error-message {
            text-align: center;
            padding: 50px;
            color: #e74c3c;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .info-bar {
                flex-direction: column;
                gap: 10px;
            }

            .status-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>友链检查器</h1>
            <p class="subtitle">实时检查友链状态，确保链接有效性</p>
        </header>

        <div class="info-bar">
            <div class="last-update">最后更新: <span id="lastUpdate">加载中...</span></div>
            <div class="total-links">总数: <span id="totalLinks">0</span></div>
            <button class="refresh-btn" onclick="fetchStatuses()">刷新</button>
        </div>

        <div id="statusContainer">
            <div class="loading">正在加载友链状态...</div>
        </div>
    </div>

    <script>
        // Fetch and display link statuses
        async function fetchStatuses() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                document.getElementById('lastUpdate').textContent = new Date(data.lastUpdate).toLocaleString();
                document.getElementById('totalLinks').textContent = data.totalLinks;
                
                const container = document.getElementById('statusContainer');
                container.innerHTML = '';
                
                if (data.statuses.length === 0) {
                    container.innerHTML = '<div class="error-message">暂无友链数据</div>';
                    return;
                }
                
                const grid = document.createElement('div');
                grid.className = 'status-grid';
                
                data.statuses.forEach(status => {
                    const card = document.createElement('div');
                    card.className = 'status-card';
                    
                    // Determine status class based on status
                    let statusClass = 'status-success';
                    let statusText = '正常';
                    
                    if (typeof status.status === 'string') {
                        statusClass = status.status === 'timeout' ? 'status-timeout' : 'status-error';
                        statusText = status.status === 'timeout' ? '超时' : '错误';
                    } else if (status.status >= 400) {
                        statusClass = 'status-error';
                        statusText = `错误 ${status.status}`;
                    } else if (status.status >= 300) {
                        statusClass = 'status-timeout';
                        statusText = `重定向 ${status.status}`;
                    }
                    
                    card.innerHTML = `
                        <div class="status-header">
                            <img class="status-avatar" src="${status.avatar || status.link.replace(/\/$/, '') + '/favicon.ico'}" 
                                onerror="this.src='http://cloudflare.imgs.lazy-boy-acmer.cn/files/Ko/Kod8PKNMyeQ4vCrC/065acdc53bdd4ed1aa52da7d408b5b3a2223.webp'; this.onerror=null;">
                            <div class="status-info">
                                <div class="status-name">${status.name}</div>
                                <a href="${status.link}" target="_blank" class="status-link">${status.link}</a>
                            </div>
                            <div class="status-indicator ${statusClass}">${statusText}</div>
                        </div>
                        <div class="status-details">
                            <div>状态码: ${status.status}</div>
                            <div class="response-time">响应时间: ${status.responseTime ? status.responseTime + 'ms' : 'N/A'}</div>
                            <div>最后检查: ${new Date(status.lastChecked).toLocaleString()}</div>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
                
                container.appendChild(grid);
            } catch (error) {
                console.error('Error fetching statuses:', error);
                document.getElementById('statusContainer').innerHTML = 
                    '<div class="error-message">加载友链状态失败，请稍后重试</div>';
            }
        }
        
        // Initial load
        fetchStatuses();
        
        // Refresh every 5 minutes
        setInterval(fetchStatuses, 5 * 60 * 1000);
    </script>
</body>
</html>